<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Find A Friend</title>
  <!--TODO: Add Custom CSS-->
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://code.jquery.com/jquery.js"></script>
</head>
<body>
  <div class="container">
    <h1>Survey Questions</h1>
    <hr>
    <form>
      <h3>About you</h3>
      <div class="form-group">
        <label for="friendName">Name (Required)</label>
        <input type="name" class="form-control" id="friendName" placeholder="" required>
      </div>
      <div class="form-group">
        <label for="friendPhoto">Link to photo image (Required)</label>
        <input type="photo" class="form-control" id="friendPhoto" placeholder="" required>
      </div>
    </form>
    <h3>
      <strong>Question 1</strong>
    </h3>
    <h4>You rarely do something just out of sheer curiosity.</h4>
    <select class="form-control" id="q1">
      <option value='0'>Choose your option</option>
      <option value='1'>1 (Strongly Disagree)</option>
      <option value='2'>2</option>
      <option value='3'>3</option>
      <option value='4'>4</option>
      <option value='5'>5 (Strongly Agree)</option>
    </select>
    <h3>
    <strong>Question 2</strong>
    </h3>
    <h4>You find it easy to stay relaxed even when there is some pressure.</h4>
    <select class="form-control" id="q2">
      <option value='0'>Choose your option</option>
      <option value='1'>1 (Strongly Disagree)</option>
      <option value='2'>2</option>
      <option value='3'>3</option>
      <option value='4'>4</option>
      <option value='5'>5 (Strongly Agree)</option>
    </select>
    <h3>
      <strong>Question 3</strong>
    </h3>
    <h4>You consider yourself more practical than creative.</h4>
    <select class="form-control" id="q3">
      <option value='0'>Choose your option</option>
      <option value='1'>1 (Strongly Disagree)</option>
      <option value='2'>2</option>
      <option value='3'>3</option>
      <option value='4'>4</option>
      <option value='5'>5 (Strongly Agree)</option>
    </select>
    <h3>
      <strong>Question 4</strong>
    </h3>
    <h4>An interesting book or a video game is often better than a social event.</h4>
    <select class="form-control" id="q4">
      <option value='0'>Choose your option</option>
      <option value='1'>1 (Strongly Disagree)</option>
      <option value='2'>2</option>
      <option value='3'>3</option>
      <option value='4'>4</option>
      <option value='5'>5 (Strongly Agree)</option>
    </select>
    <h3>
      <strong>Question 5</strong>
    </h3>
    <h4>You often find yourself lost in thought when you are walking in nature.</h4>
    <select class="form-control" id="q5">
      <option value='0'>Choose your option</option>
      <option value='1'>1 (Strongly Disagree)</option>
      <option value='2'>2</option>
      <option value='3'>3</option>
      <option value='4'>4</option>
      <option value='5'>5 (Strongly Agree)</option>
    </select>
    <h3>
      <strong>Question 6</strong>
    </h3>
    <h4>You do not let other people influence your actions.</h4>
    <select class="form-control" id="q6">
      <option value='0'>Choose your option</option>
      <option value='1'>1 (Strongly Disagree)</option>
      <option value='2'>2</option>
      <option value='3'>3</option>
      <option value='4'>4</option>
      <option value='5'>5 (Strongly Agree)</option>
    </select>
    <h3>
      <strong>Question 7</strong>
    </h3>
    <h4>You are more of a natural improviser than a careful planner.</h4>
    <select class="form-control" id="q7">
      <option value='0'>Choose your option</option>
      <option value='1'>1 (Strongly Disagree)</option>
      <option value='2'>2</option>
      <option value='3'>3</option>
      <option value='4'>4</option>
      <option value='5'>5 (Strongly Agree)</option>
    </select>
    <h3>
      <strong>Question 8</strong>
    </h3>
    <h4>If you had a business, you would find it very difficult to fire loyal but underperforming employees.</h4>
    <select class="form-control" id="q8">
      <option value='0'>Choose your option</option>
      <option value='1'>1 (Strongly Disagree)</option>
      <option value='2'>2</option>
      <option value='3'>3</option>
      <option value='4'>4</option>
      <option value='5'>5 (Strongly Agree)</option>
    </select>
    <h3>
      <strong>Question 9</strong>
    </h3>
    <h4>You often contemplate the reasons for human existence.</h4>
    <select class="form-control" id="q9">
      <option value='0'>Choose your option</option>
      <option value='1'>1 (Strongly Disagree)</option>
      <option value='2'>2</option>
      <option value='3'>3</option>
      <option value='4'>4</option>
      <option value='5'>5 (Strongly Agree)</option>
    </select>
    <h3>
      <strong>Question 10</strong>
    </h3>
    <h4>If your friend is sad about something, you are more likely to offer emotional support than suggest ways to deal with the problem.</h4>
    <select class="form-control" id="q10">
      <option value='0'>Choose your option</option>
      <option value='1'>1 (Strongly Disagree)</option>
      <option value='2'>2</option>
      <option value='3'>3</option>
      <option value='4'>4</option>
      <option value='5'>5 (Strongly Agree)</option>
    </select>
    <br>
    <button type="submit" data-target="modal-1" class="btn btn-primary submit" id="submitBtn">Submit</button>
    <footer class="footer">
      <div class="container">
        <p>
          <a href="/api/friends">API Friends List</a> |
        </p>
      </div>
      <!--Modal Code-->
      <div id ="modal1" class="modal" style="display: none">
        <div class="modal-content">
          <h4>Meet Your New Friend!</h4>
          <h5 id="matchName"></h5>
          <img id="matchPic" src="" alt="No Image" width=250px>
        </div>
        <div class="modal-footer">
        <span class="close" id='btnClose'>&times;</span>
          <a href="#!"></a>
        </div>
        </div>
      </div>
    </footer> 
  </div>
</body>
<script type= "text/javascript">

$("#btnClose").on("click", function(e){
    e.preventDefault() 
    document.getElementById("modal1").style.display = "none";
  });

$("#submitBtn").on("click", function(e){
    e.preventDefault() 
    var newFriend= {
        name: $("#friendName").val().trim(),
        photo: $("#friendPhoto").val().trim(),
        scores: [
            $("#q1").val(),
            $("#q2").val(),
            $("#q3").val(),
            $("#q4").val(),
            $("#q5").val(),
            $("#q6").val(),
            $("#q7").val(),
            $("#q8").val(),
            $("#q9").val(),
            $("#q10").val()
        ]

    }
    console.log("Trying to create a new friend: " + JSON.stringify(newFriend, null, 2));
    suggestAFriend(newFriend);
});

function createFriend(newFriend){
  console.log("createFriend()");
  // Post newFriend object into databse using a post call to /api/friends
  $.post("/api/friends", newFriend, function(result){
    console.log("result: " + result);
  });
}

function suggestAFriend(newFriend){
  console.log("Suggesting a friend...");
  // Determine totalDifference for this set of scores
  // Determine the user's most compatible friend using the following as a guide:

  //  * Convert each user's results into a simple array of numbers (ex: `[5, 1, 4, 4, 5, 1, 2, 5, 4, 1]`).
  //  * With that done, compare the difference between current user's scores against those from other users, 
  // question by question. Add up the differences to calculate the `totalDifference`.
  //    * Example:
  //      * User 1: `[5, 1, 4, 4, 5, 1, 2, 5, 4, 1]`
  //      * User 2: `[3, 2, 6, 4, 5, 1, 2, 5, 4, 1]`
  //      * Total Difference: **2 + 1 + 2 =** **_5_**
  //  * Remember to use the absolute value of the differences. Put another way: no negative solutions! Your app should calculate both `5-3` and `3-5` as `2`, and so on.
  //  * The closest match will be the user with the least amount of difference.
  // Comparing scores to every set of scores in the database
  // Pull in the database
  var scores = newFriend.scores;

  $.get("/api/friends", function(data, status){
    // alert("Data: " + data + "\nStatus: " + status);
    var friends = JSON.stringify(data, null, 2);
    console.log("friends from api call: " + friends);

    if(data.length > 0){
      let closest_match = 0;
      let lowest_score = 1000;
        for (let i = 0; i < data.length; i++) {
            if(data[i].scores && data[i].scores.length > 0 ){
                let curr_scores = data[i].scores;
                // calculate score here
                let diff = getDifferenceInScore(curr_scores, scores);
                if(diff < lowest_score){
                    lowest_score = diff;
                    closest_match = i;
                }
            }
        }
        console.log("Suggesting friend " + data[closest_match].name);
        showSuggestedFriend(data[closest_match]);
    }
    createFriend(newFriend);
      });
    }

function getDifferenceInScore(score_1, score_2){
        let sum = 0;
        for (let i = 0; i < score_1.length; i++) {
            let num_1 = Number(score_1[i]);
            let num_2 = Number(score_2[i]);
            let diff = num_1 - num_2;
            if(diff < 0){
                sum += - diff;
            }else {
                sum +=  diff;
            }
        }
        return sum;
    }

    function showSuggestedFriend(friend){
      let name = friend.name;
      let photo = friend.photo;
      let name_element = document.getElementById("matchName");
      let photo_element = document.getElementById("matchPic");

      name_element.innerHTML = name;
      photo_element.src= photo;
      document.getElementById("modal1").style.display = "block";
    }

</script>
</html>

